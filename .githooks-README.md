# Git Hooks for Five Crowns Scorer

This project includes automated Git hooks to maintain code quality and catch issues early.

## Installed Hooks

### pre-commit
Runs before each commit to catch issues early:
- ‚úì **JavaScript Linting**: Validates syntax with `make lint`
- ‚úì **Project Structure**: Ensures all required files exist with `make validate`
- ‚ö†Ô∏è **Console.log Detection**: Warns about console.log statements (non-blocking)
- üìù **TODO/FIXME Tracker**: Shows any TODO/FIXME comments (informational)
- üé≠ **Puppeteer Tests**: Runs E2E tests if dependencies are installed and JS files changed
- üì¶ **Large File Detection**: Warns about files >500KB

### pre-push
Runs before pushing to remote to ensure quality:
- ‚úì **Working Directory Check**: Warns if uncommitted changes exist
- üß™ **Full Test Suite**: Runs `make test` (lint + validate)
- üéØ **Main Branch Protection**: Additional checks when pushing to main/master
- üé≠ **E2E Tests**: Runs Puppeteer tests on main branch pushes

### commit-msg
Validates commit message quality:
- ‚úì **Minimum Length**: Requires at least 10 characters
- ‚ö†Ô∏è **Generic Message Detection**: Warns about vague messages like "fix", "update"
- ‚ö†Ô∏è **All-caps Detection**: Warns if message is shouting
- üí° **Conventional Commits**: Suggests conventional format (optional)

## Quick Start

The hooks are already installed in `.git/hooks/` and ready to use. Just commit and push as normal!

```bash
# Make a change
git add .

# Commit (hooks run automatically)
git commit -m "Add new feature"

# Push (hooks run automatically)
git push origin main
```

## Managing Hooks

### Temporarily Skip Hooks
If you need to bypass hooks (use sparingly):

```bash
# Skip pre-commit checks
git commit --no-verify -m "Emergency fix"

# Skip pre-push checks
git push --no-verify
```

### Enable/Disable Specific Checks

Edit the hook files in `.git/hooks/` to customize behavior:

- **Block console.log**: Uncomment line in pre-commit hook
- **Enforce conventional commits**: Uncomment section in commit-msg hook
- **Skip Puppeteer tests**: Remove/comment out the Puppeteer section

### Reinstall Hooks

```bash
make install-hooks  # Reinstall all hooks
```

## Hook Behavior

### Pre-commit Behavior
- **Blocking**: Linting errors, validation failures, Puppeteer test failures
- **Non-blocking**: console.log warnings, TODO comments, large file warnings (prompts user)

### Pre-push Behavior
- **Blocking**: Test failures, validation errors
- **Non-blocking**: Uncommitted changes warning (prompts user)

### Commit-msg Behavior
- **Blocking**: Messages shorter than 10 characters
- **Non-blocking**: Generic message warnings, formatting suggestions

## Testing the Hooks

Test the hooks without making actual commits:

```bash
# Test pre-commit hook
.git/hooks/pre-commit

# Test pre-push hook
.git/hooks/pre-push

# Test commit-msg hook
echo "test message" > /tmp/test-commit-msg
.git/hooks/commit-msg /tmp/test-commit-msg
```

## Dependencies

- **Core Checks**: No dependencies (lint, validate work out of the box)
- **Puppeteer Tests**: Requires `make setup` to install dependencies
  ```bash
  make setup  # Install Puppeteer and other test dependencies
  ```

## Customization

### Adding Custom Checks

Edit `.git/hooks/pre-commit` to add your own checks:

```bash
# Example: Check for debugger statements
echo "üîç Checking for debugger statements..."
if grep -r "debugger" js/*.js; then
    echo "‚úó Found debugger statements!"
    FAILED=1
fi
```

### Configuring Test Behavior

Modify which tests run by editing the hooks:
- Skip E2E tests: Comment out `make test-puppeteer`
- Add unit tests: Add `make test-unit` command
- Run custom scripts: Add your own validation commands

## Troubleshooting

### Hooks Not Running
```bash
# Ensure hooks are executable
chmod +x .git/hooks/*
```

### Hooks Taking Too Long
- Skip Puppeteer tests if not needed (remove `make test-puppeteer`)
- Use `git commit --no-verify` for urgent commits (then fix issues later)

### False Positives
- Edit the specific hook to adjust thresholds
- Add exclusions for specific files/patterns

## Best Practices

1. **Run tests locally**: `make test` before committing
2. **Small commits**: Easier for hooks to validate quickly
3. **Fix warnings**: Even non-blocking warnings indicate issues
4. **Keep hooks fast**: Heavy tests should be in CI, not pre-commit
5. **Team alignment**: Share hook customizations with the team

## CI/CD Integration

These hooks complement (not replace) CI/CD pipelines:
- Hooks: Fast, local, immediate feedback
- CI/CD: Comprehensive, slower, authoritative

Both should run the same tests for consistency.

## Resources

- [Git Hooks Documentation](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)
- [Conventional Commits](https://www.conventionalcommits.org/)
- Project Makefile: See all available test commands
